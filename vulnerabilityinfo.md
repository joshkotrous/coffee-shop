# Security Vulnerabilities for Testing

This document outlines intentional security vulnerabilities implemented in this coffee shop demo application for security scanner testing and dynamic analysis purposes.

## Authentication & Authorization Issues

### 1. Weak JWT Secret Management

- **Location**: `lib/auth.ts` line 21, `.env.example`
- **Issue**: Uses a weak fallback JWT secret when environment variable is not set
- **Risk**: Token forgery if secret is compromised or predictable

### 2. Insufficient Password Policy

- **Location**: `app/api/auth/register/route.ts` and auth forms
- **Issue**: No password complexity requirements, minimum length, or common password checks
- **Risk**: Users can set weak passwords like "123" or "password"

### 3. Missing Rate Limiting

- **Location**: All authentication endpoints (`/api/auth/*`)
- **Issue**: No rate limiting on login attempts or registration
- **Risk**: Brute force attacks, account enumeration

## Input Validation & Injection

### 4. SQL Injection Vulnerability

- **Location**: `/api/products` GET endpoint with search parameter
- **Issue**: Search functionality uses unsafe string concatenation to build SQL queries
- **Risk**: Complete database compromise, data extraction, unauthorized modifications
- **Exploit**: Send request like `/api/products?search='; DROP TABLE users; --` to execute arbitrary SQL

### 5. Missing Input Validation

- **Location**: Product creation (`/api/products` POST), Order creation
- **Issue**: Minimal validation on user inputs (prices, quantities, descriptions)
- **Risk**: Invalid data insertion, potential application errors

## Session Management

### 6. Insecure Cookie Configuration

- **Location**: Authentication routes setting JWT cookies
- **Issue**: Missing secure flag, sameSite attribute not configured properly
- **Risk**: Session hijacking, CSRF attacks

### 7. No Session Invalidation on Password Change

- **Issue**: Sessions remain valid after password changes
- **Risk**: Compromised sessions remain active

## Authorization Issues

### 8. Direct Object References

- **Location**: Order viewing, admin functions
- **Issue**: Basic authorization checks but potential for horizontal privilege escalation
- **Risk**: Users might access other users' data with direct ID manipulation

### 9. Admin Role Escalation Potential

- **Location**: User registration allows any role in database
- **Issue**: No protection against role manipulation during registration
- **Risk**: Users could potentially register with admin privileges

## Information Disclosure

### 10. Verbose Error Messages

- **Location**: API error responses throughout application
- **Issue**: Detailed error messages may reveal internal system information
- **Risk**: Information leakage about database structure, internal paths

### 11. No HTTPS Enforcement

- **Issue**: Application runs on HTTP in development
- **Risk**: Credentials and session tokens transmitted in clear text

## Business Logic

### 12. Race Conditions in Stock Management

- **Location**: Order processing (`/api/orders` POST)
- **Issue**: Stock updates not properly synchronized
- **Risk**: Overselling products, inventory discrepancies

### 13. Price Manipulation

- **Location**: Order creation process
- **Issue**: Prices fetched from database during order creation
- **Risk**: Time-of-check vs time-of-use issues

## Testing Credentials

For security testing purposes:

- **Admin Account**: admin@coffeeshop.com / admin123
- **Test Users**: Can be created through registration

### 14. Remote Code Execution (RCE) via Diagnostic Interface

- **Location**: `/api/admin/diagnostics` endpoint in admin interface
- **Issue**: Admin diagnostic interface executes arbitrary JavaScript code via eval()
- **Risk**: Complete server compromise, application shutdown, data theft
- **Exploit**: Send POST request with `{"command": "process.exit()"}` to shut down application

## Deployment Notes

- Database credentials are exposed in docker-compose.yml for demo purposes
- Environment variables should be properly secured in production
- SSL/TLS should be enforced in production environments
